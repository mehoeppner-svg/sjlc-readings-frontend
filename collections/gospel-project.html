<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The Gospel Project - Journey through the grand narrative of Scripture in chronological order over three years.">
    <title>The Gospel Project | St. John Lutheran Church</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/collections.css">
    <style>
        /* ===== GOSPEL PROJECT PAGE STYLES ===== */

        /* Back Navigation */
        .back-nav {
            max-width: 1000px;
            margin: 0 auto;
            padding: var(--spacing-md) var(--spacing-md) 0;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.95rem;
            transition: color var(--transition-fast);
        }

        .back-link:hover {
            color: var(--accent-color);
        }

        .back-link::before {
            content: '←';
            font-size: 1.1rem;
        }

        /* Page Container */
        .gospel-page-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: var(--spacing-md) var(--spacing-md) var(--spacing-xl);
        }

        /* Hero Section */
        .hero-section {
            text-align: center;
            padding: var(--spacing-lg);
            background: linear-gradient(135deg, rgba(114, 171, 191, 0.08) 0%, rgba(242, 243, 245, 0.9) 100%);
            border-radius: 12px;
            margin-bottom: var(--spacing-lg);
        }

        .hero-title {
            font-family: var(--font-serif);
            font-size: 2.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 var(--spacing-sm);
        }

        .hero-description {
            font-size: 1.1rem;
            line-height: 1.8;
            color: var(--text-secondary);
            max-width: 800px;
            margin: 0 auto;
        }

        /* Timeline Section */
        .timeline-section {
            background: var(--bg-white);
            border-radius: 12px;
            padding: var(--spacing-lg);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: var(--spacing-lg);
        }

        .timeline-title {
            font-family: var(--font-serif);
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 var(--spacing-md);
            text-align: center;
        }

        .timeline-progress {
            position: relative;
            height: 80px;
            margin-bottom: var(--spacing-sm);
        }

        .timeline-bar {
            position: absolute;
            top: 40px;
            left: 0;
            right: 0;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
        }

        .timeline-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color) 0%, var(--accent-color) 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .timeline-milestone {
            position: absolute;
            top: 20px;
            transform: translateX(-50%);
            text-align: center;
        }

        .milestone-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--bg-white);
            border: 3px solid var(--border-color);
            margin: 0 auto 0.5rem;
            transition: all 0.3s ease;
        }

        .timeline-milestone.completed .milestone-dot {
            background: var(--success-color);
            border-color: var(--success-color);
        }

        .timeline-milestone.current .milestone-dot {
            background: var(--accent-color);
            border-color: var(--accent-color);
            box-shadow: 0 0 0 4px rgba(114, 171, 191, 0.2);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 4px rgba(114, 171, 191, 0.2); }
            50% { box-shadow: 0 0 0 8px rgba(114, 171, 191, 0.1); }
        }

        .milestone-label {
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .timeline-milestone.current .milestone-label {
            color: var(--accent-color);
            font-weight: 600;
        }

        .progress-text {
            text-align: center;
            font-size: 1rem;
            color: var(--text-secondary);
            margin-top: var(--spacing-sm);
        }

        .progress-text strong {
            color: var(--accent-color);
            font-weight: 600;
        }

        /* Themes Section */
        .themes-section {
            margin-top: var(--spacing-lg);
        }

        .themes-title {
            font-family: var(--font-serif);
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 var(--spacing-md);
        }

        .themes-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .theme-item {
            background: var(--bg-white);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            transition: box-shadow var(--transition-normal);
        }

        .theme-item:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
        }

        .theme-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.25rem 1.5rem;
            cursor: pointer;
            user-select: none;
            gap: 1rem;
        }

        .theme-header:hover {
            background: rgba(114, 171, 191, 0.03);
        }

        .theme-info {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .theme-status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .theme-status.completed {
            background: var(--success-color);
            color: white;
        }

        .theme-status.current {
            background: var(--accent-color);
            color: white;
        }

        .theme-status.upcoming {
            background: var(--border-color);
            color: var(--text-tertiary);
        }

        .theme-title-group {
            flex: 1;
            min-width: 200px;
        }

        .theme-name {
            font-family: var(--font-serif);
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 0.25rem;
        }

        .theme-dates {
            font-size: 0.9rem;
            color: var(--text-tertiary);
        }

        .theme-passage {
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 4px;
            background: var(--bg-light);
            transition: all var(--transition-fast);
            flex-shrink: 0;
        }

        .theme-toggle::after {
            content: '▼';
            font-size: 0.8rem;
            color: var(--text-secondary);
            transition: transform var(--transition-fast);
        }

        .theme-item.expanded .theme-toggle::after {
            transform: rotate(-180deg);
        }

        .theme-toggle:hover {
            background: var(--accent-color);
        }

        .theme-toggle:hover::after {
            color: white;
        }

        .theme-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .theme-item.expanded .theme-content {
            max-height: 1000px;
        }

        .theme-days {
            padding: 1rem 1.5rem 1.5rem;
            border-top: 1px solid var(--bg-light);
            background: rgba(248, 249, 250, 0.5);
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 0.75rem;
        }

        .day-link {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background: var(--bg-white);
            border-radius: 6px;
            text-decoration: none;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .day-link:hover {
            background: var(--accent-color);
            transform: translateX(4px);
            box-shadow: 0 2px 8px rgba(114, 171, 191, 0.2);
        }

        .day-link.completed {
            border-left: 3px solid var(--success-color);
        }

        .day-link.current {
            border-left: 3px solid var(--accent-color);
            background: rgba(114, 171, 191, 0.05);
        }

        .day-info {
            flex: 1;
        }

        .day-date {
            font-size: 0.85rem;
            color: var(--text-tertiary);
            margin-bottom: 0.25rem;
        }

        .day-link:hover .day-date {
            color: rgba(255, 255, 255, 0.8);
        }

        .day-passage {
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .day-link:hover .day-passage {
            color: white;
        }

        .day-arrow {
            font-size: 1.2rem;
            color: var(--text-tertiary);
            transition: transform 0.2s ease;
        }

        .day-link:hover .day-arrow {
            color: white;
            transform: translateX(4px);
        }

        /* Loading State */
        .page-loading {
            display: flex;
            justify-content: center;
            padding: var(--spacing-xl);
        }

        .page-loading[hidden] {
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .gospel-page-container {
                padding: var(--spacing-sm);
            }

            .hero-section {
                padding: var(--spacing-md);
            }

            .hero-title {
                font-size: 2rem;
            }

            .hero-description {
                font-size: 1rem;
            }

            .timeline-section {
                padding: var(--spacing-md);
            }

            .timeline-progress {
                height: 100px;
            }

            .milestone-label {
                font-size: 0.7rem;
            }

            .theme-header {
                padding: 1rem;
            }

            .theme-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .theme-name {
                font-size: 1.1rem;
            }

            .days-grid {
                grid-template-columns: 1fr;
            }

            .theme-days {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Header with Banner -->
    <header class="site-header">
        <div class="banner-container">
            <img src="../assets/banner.png" alt="Stained glass style artwork depicting creation, the cross, and the church" class="banner-image">
            <div class="banner-overlay">
                <h1 class="site-title">Daily Bible Readings</h1>
                <p class="site-subtitle">St. John Lutheran Church &#8226; Boerne, TX</p>
            </div>
        </div>
        <nav class="main-nav" aria-label="Main navigation">
            <button class="nav-toggle" aria-expanded="false" aria-controls="nav-menu" aria-label="Toggle navigation menu">
                <span class="hamburger"></span>
            </button>
            <ul class="nav-menu" id="nav-menu">
                <li><a href="../index.html" class="nav-link">Home</a></li>
                <li><a href="../reading.html" class="nav-link">Today</a></li>
                <li><a href="../browse.html" class="nav-link">Browse</a></li>
                <li><a href="../collections.html" class="nav-link active" aria-current="page">Collections</a></li>
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <main id="main-content">
        <!-- Back Navigation -->
        <div class="back-nav">
            <a href="../collections.html" class="back-link">Back to Collections</a>
        </div>

        <!-- Loading State -->
        <div class="page-loading" id="pageLoading">
            <div class="loading-spinner"></div>
        </div>

        <div class="gospel-page-container" id="pageContent" hidden>
            <!-- Hero Section -->
            <section class="hero-section">
                <h2 class="hero-title">The Gospel Project</h2>
                <p class="hero-description">
                    Journey through the grand narrative of Scripture in chronological order. Over three years,
                    we'll explore God's story from Creation to the Early Church, discovering how every part of
                    the Bible points to Jesus Christ and His redemptive work.
                </p>
            </section>

            <!-- Timeline Section -->
            <section class="timeline-section">
                <h3 class="timeline-title">Your Journey Through Scripture</h3>
                <div class="timeline-progress">
                    <div class="timeline-bar">
                        <div class="timeline-bar-fill" id="timelineFill"></div>
                    </div>
                    <div id="milestonesContainer">
                        <!-- Milestones populated by JS -->
                    </div>
                </div>
                <p class="progress-text" id="progressText">
                    Loading progress...
                </p>
            </section>

            <!-- Themes Section -->
            <section class="themes-section">
                <h3 class="themes-title">All Themes</h3>
                <div class="themes-list" id="themesList">
                    <!-- Themes populated by JS -->
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <p>&copy; 2025 St. John Lutheran Church. All rights reserved.</p>
        <p>Scripture quotations are from the ESV Bible, copyright Crossway.</p>
    </footer>

    <script src="../js/app.js"></script>
    <script>
        /**
         * Gospel Project Page - Dynamic timeline and themes
         * All data loaded from readings.json
         */

        // Bible book to era mapping
        const BIBLE_ERAS = {
            // Era 1: Creation & Patriarchs
            'Genesis': 'Creation & Patriarchs',

            // Era 2: Exodus & Law
            'Exodus': 'Exodus & Law',
            'Leviticus': 'Exodus & Law',
            'Numbers': 'Exodus & Law',
            'Deuteronomy': 'Exodus & Law',

            // Era 3: Conquest & Judges
            'Joshua': 'Conquest & Judges',
            'Judges': 'Conquest & Judges',
            'Ruth': 'Conquest & Judges',

            // Era 4: Kingdom
            '1 Samuel': 'Kingdom',
            '2 Samuel': 'Kingdom',
            '1 Kings': 'Kingdom',
            '2 Kings': 'Kingdom',
            '1 Chronicles': 'Kingdom',
            '2 Chronicles': 'Kingdom',

            // Era 5: Exile & Return
            'Ezra': 'Exile & Return',
            'Nehemiah': 'Exile & Return',
            'Esther': 'Exile & Return',
            'Job': 'Exile & Return',
            'Proverbs': 'Exile & Return',
            'Ecclesiastes': 'Exile & Return',
            'Song of Solomon': 'Exile & Return',
            'Isaiah': 'Exile & Return',
            'Jeremiah': 'Exile & Return',
            'Lamentations': 'Exile & Return',
            'Ezekiel': 'Exile & Return',
            'Daniel': 'Exile & Return',
            'Hosea': 'Exile & Return',
            'Joel': 'Exile & Return',
            'Amos': 'Exile & Return',
            'Obadiah': 'Exile & Return',
            'Jonah': 'Exile & Return',
            'Micah': 'Exile & Return',
            'Nahum': 'Exile & Return',
            'Habakkuk': 'Exile & Return',
            'Zephaniah': 'Exile & Return',
            'Haggai': 'Exile & Return',
            'Zechariah': 'Exile & Return',
            'Malachi': 'Exile & Return',

            // Era 6: Jesus
            'Matthew': 'Jesus',
            'Mark': 'Jesus',
            'Luke': 'Jesus',
            'John': 'Jesus',

            // Era 7: Church
            'Acts': 'Church',
            'Romans': 'Church',
            '1 Corinthians': 'Church',
            '2 Corinthians': 'Church',
            'Galatians': 'Church',
            'Ephesians': 'Church',
            'Philippians': 'Church',
            'Colossians': 'Church',
            '1 Thessalonians': 'Church',
            '2 Thessalonians': 'Church',
            '1 Timothy': 'Church',
            '2 Timothy': 'Church',
            'Titus': 'Church',
            'Philemon': 'Church',
            'Hebrews': 'Church',
            'James': 'Church',
            '1 Peter': 'Church',
            '2 Peter': 'Church',
            '1 John': 'Church',
            '2 John': 'Church',
            '3 John': 'Church',
            'Jude': 'Church',
            'Revelation': 'Church',

            // Psalms - scattered throughout, don't affect era calculation
            'Psalms': null,
            'Psalm': null
        };

        // Era order for milestone display
        const ERA_ORDER = [
            'Creation & Patriarchs',
            'Exodus & Law',
            'Conquest & Judges',
            'Kingdom',
            'Exile & Return',
            'Jesus',
            'Church'
        ];

        // State
        let yearDataCache = {};
        let readings = [];
        let themes = [];

        // DOM Elements
        const pageLoading = document.getElementById('pageLoading');
        const pageContent = document.getElementById('pageContent');
        const timelineFill = document.getElementById('timelineFill');
        const milestonesContainer = document.getElementById('milestonesContainer');
        const progressText = document.getElementById('progressText');
        const themesList = document.getElementById('themesList');

        // Initialize
        document.addEventListener('DOMContentLoaded', init);

        async function init() {
            await loadAllYearData();
            extractReadings();
            calculateProgress();
            renderMilestones();
            renderThemes();
            showContent();
        }

        /**
         * Load data from all available years
         */
        async function loadAllYearData() {
            const currentYear = new Date().getFullYear();
            const startYear = 2020;
            const endYear = currentYear + 5;

            const fetchPromises = [];
            for (let year = startYear; year <= endYear; year++) {
                fetchPromises.push(loadYearData(year));
            }

            await Promise.all(fetchPromises);
        }

        /**
         * Fetch year data from JSON file
         */
        async function loadYearData(year) {
            try {
                const response = await fetch(`../years/${year}/readings.json`);
                if (!response.ok) {
                    yearDataCache[year] = { year, collections: [], readings: [] };
                    return;
                }
                yearDataCache[year] = await response.json();
            } catch (error) {
                yearDataCache[year] = { year, collections: [], readings: [] };
            }
        }

        /**
         * Extract readings for this collection
         */
        function extractReadings() {
            readings = [];

            Object.values(yearDataCache).forEach(yearData => {
                if (yearData.readings) {
                    yearData.readings.forEach(reading => {
                        if (reading.collection === 'gospel-project') {
                            readings.push(reading);
                        }
                    });
                }
            });

            // Sort by date
            readings.sort((a, b) => a.date.localeCompare(b.date));

            // Group into themes
            groupIntoThemes();
        }

        /**
         * Group readings into themes
         */
        function groupIntoThemes() {
            themes = [];
            let currentTheme = null;

            readings.forEach(reading => {
                const themeName = reading.theme || 'Untitled';

                if (!currentTheme || currentTheme.name !== themeName) {
                    // Start new theme
                    currentTheme = {
                        name: themeName,
                        readings: [],
                        startDate: reading.date,
                        endDate: reading.date
                    };
                    themes.push(currentTheme);
                }

                currentTheme.readings.push(reading);
                currentTheme.endDate = reading.date;
            });

            // Calculate overall passage for each theme
            themes.forEach(theme => {
                if (theme.readings.length > 0) {
                    // Get unique books
                    const books = [...new Set(theme.readings.map(r => extractBook(r.passage)))];
                    theme.passage = books.join(', ');
                }
            });
        }

        /**
         * Extract book name from passage (e.g., "Genesis 1:1-13" -> "Genesis")
         */
        function extractBook(passage) {
            // Handle numbered books (1 Samuel, 2 Kings, etc.)
            const match = passage.match(/^(\d?\s*[A-Za-z]+)/);
            return match ? match[1].trim() : passage;
        }

        /**
         * Calculate progress and update timeline
         * Progress is based on WHERE in the Bible we are (era), not reading count
         */
        function calculateProgress() {
            if (readings.length === 0) {
                progressText.textContent = 'No readings available yet.';
                return;
            }

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // Find the latest reading (on or before today) that ISN'T Psalms
            let latestNonPsalmReading = null;
            for (let i = readings.length - 1; i >= 0; i--) {
                const readingDate = parseDate(readings[i].date);
                // Skip future readings
                if (readingDate > today) continue;

                const book = extractBook(readings[i].passage);
                if (book !== 'Psalm' && book !== 'Psalms') {
                    latestNonPsalmReading = readings[i];
                    break;
                }
            }

            if (!latestNonPsalmReading) {
                progressText.textContent = 'The journey begins soon!';
                return;
            }

            // Determine which era this reading belongs to
            const book = extractBook(latestNonPsalmReading.passage);
            const era = BIBLE_ERAS[book];
            const eraIndex = era ? ERA_ORDER.indexOf(era) : -1;

            // Calculate progress as position on timeline (based on era)
            // Each era is evenly spaced, so era 0 = 0%, era 6 = 100%
            const progress = eraIndex >= 0
                ? (eraIndex / (ERA_ORDER.length - 1)) * 100
                : 0;

            // Update progress bar
            timelineFill.style.width = `${progress}%`;

            // Update progress text
            if (eraIndex >= 0) {
                const percentage = Math.round(progress);
                const eraName = ERA_ORDER[eraIndex];
                progressText.innerHTML = `You are <strong>${percentage}% through</strong> the journey (currently in ${eraName})`;
            } else {
                progressText.textContent = 'The journey begins soon!';
            }
        }

        /**
         * Render timeline milestones
         * Shows ALL eras as fixed milestones, with state based on latest non-Psalm reading (on or before today)
         */
        function renderMilestones() {
            milestonesContainer.innerHTML = '';

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // Find the current era based on latest non-Psalm reading (on or before today)
            let currentEraIndex = -1;

            if (readings.length > 0) {
                // Find the latest reading (on or before today) that ISN'T Psalms
                for (let i = readings.length - 1; i >= 0; i--) {
                    const readingDate = parseDate(readings[i].date);
                    // Skip future readings
                    if (readingDate > today) continue;

                    const book = extractBook(readings[i].passage);
                    if (book !== 'Psalm' && book !== 'Psalms') {
                        const era = BIBLE_ERAS[book];
                        if (era) {
                            currentEraIndex = ERA_ORDER.indexOf(era);
                        }
                        break;
                    }
                }
            }

            // Render ALL eras as milestones, evenly spaced
            ERA_ORDER.forEach((era, i) => {
                // Position evenly across the timeline (0% to 100%)
                const position = (i / (ERA_ORDER.length - 1)) * 100;

                // Determine state based on current era
                let state = 'upcoming';
                if (currentEraIndex >= 0) {
                    if (i < currentEraIndex) {
                        state = 'completed';
                    } else if (i === currentEraIndex) {
                        state = 'current';
                    }
                }

                // Create milestone element
                const milestone = document.createElement('div');
                milestone.className = `timeline-milestone ${state}`;
                milestone.style.left = `${position}%`;

                const dot = document.createElement('div');
                dot.className = 'milestone-dot';

                const label = document.createElement('div');
                label.className = 'milestone-label';
                // Shorten labels for display
                const shortLabels = {
                    'Creation & Patriarchs': 'Creation',
                    'Exodus & Law': 'Exodus',
                    'Conquest & Judges': 'Judges',
                    'Kingdom': 'Kingdom',
                    'Exile & Return': 'Exile',
                    'Jesus': 'Jesus',
                    'Church': 'Church'
                };
                label.textContent = shortLabels[era] || era;

                milestone.appendChild(dot);
                milestone.appendChild(label);
                milestonesContainer.appendChild(milestone);
            });
        }

        /**
         * Render themes accordion
         */
        function renderThemes() {
            themesList.innerHTML = '';

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            themes.forEach((theme, index) => {
                const themeItem = document.createElement('div');
                themeItem.className = 'theme-item';
                themeItem.id = `theme-${index}`;

                // Determine theme status
                const startDate = parseDate(theme.startDate);
                const endDate = parseDate(theme.endDate);

                let status = 'upcoming';
                let statusIcon = '';

                if (today > endDate) {
                    status = 'completed';
                    statusIcon = '✓';
                } else if (today >= startDate) {
                    status = 'current';
                    statusIcon = '→';
                    themeItem.classList.add('expanded'); // Auto-expand current theme
                }

                // Header
                const header = document.createElement('div');
                header.className = 'theme-header';
                header.onclick = () => toggleTheme(index);

                header.innerHTML = `
                    <div class="theme-info">
                        <div class="theme-status ${status}">${statusIcon}</div>
                        <div class="theme-title-group">
                            <h4 class="theme-name">${theme.name}</h4>
                            <div class="theme-dates">${formatDateRange(theme.startDate, theme.endDate)}</div>
                        </div>
                        <div class="theme-passage">${theme.passage || ''}</div>
                    </div>
                    <div class="theme-toggle"></div>
                `;

                // Content (days)
                const content = document.createElement('div');
                content.className = 'theme-content';

                const days = document.createElement('div');
                days.className = 'theme-days';

                const grid = document.createElement('div');
                grid.className = 'days-grid';

                theme.readings.forEach(reading => {
                    const readingDate = parseDate(reading.date);
                    let dayStatus = '';

                    if (readingDate < today) {
                        dayStatus = 'completed';
                    } else if (readingDate.toDateString() === today.toDateString()) {
                        dayStatus = 'current';
                    }

                    const dayLink = document.createElement('a');
                    dayLink.href = `../reading.html?date=${reading.date}`;
                    dayLink.className = `day-link ${dayStatus}`;

                    dayLink.innerHTML = `
                        <div class="day-info">
                            <div class="day-date">${formatDateShort(reading.date)}</div>
                            <div class="day-passage">${reading.passage}</div>
                        </div>
                        <div class="day-arrow">→</div>
                    `;

                    grid.appendChild(dayLink);
                });

                days.appendChild(grid);
                content.appendChild(days);

                themeItem.appendChild(header);
                themeItem.appendChild(content);
                themesList.appendChild(themeItem);
            });
        }

        /**
         * Toggle theme expansion
         */
        function toggleTheme(index) {
            const themeItem = document.getElementById(`theme-${index}`);
            themeItem.classList.toggle('expanded');
        }

        /**
         * Show page content
         */
        function showContent() {
            pageLoading.hidden = true;
            pageContent.hidden = false;
        }

        /**
         * Parse YYYY-MM-DD to Date
         */
        function parseDate(dateStr) {
            const [year, month, day] = dateStr.split('-').map(Number);
            return new Date(year, month - 1, day);
        }

        /**
         * Format date range
         */
        function formatDateRange(startDate, endDate) {
            const start = parseDate(startDate);
            const end = parseDate(endDate);

            const startMonth = start.toLocaleDateString('en-US', { month: 'short' });
            const startDay = start.getDate();
            const endMonth = end.toLocaleDateString('en-US', { month: 'short' });
            const endDay = end.getDate();
            const year = end.getFullYear();

            if (startMonth === endMonth) {
                return `${startMonth} ${startDay}-${endDay}, ${year}`;
            }

            return `${startMonth} ${startDay} - ${endMonth} ${endDay}, ${year}`;
        }

        /**
         * Format date as "Mon 15"
         */
        function formatDateShort(dateStr) {
            const date = parseDate(dateStr);
            return date.toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric'
            });
        }
    </script>
</body>
</html>
