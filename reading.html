---
layout: reading
extra_js: /js/reading.js
extra_css: /css/reading.css
title: "Today's Reading"
og_title: "Today's Daily Scripture Reading"
og_description: "Read today's daily Scripture passage from St. John Lutheran Church's Bible reading program"
og_type: website
og_image: /assets/banner.png
permalink: /reading.html
---

<div id="reading-container">
    <div style="text-align: center; padding: 40px;">
        <p>Loading today's reading...</p>
    </div>
</div>

<script>
    (function() {
        'use strict';

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function getTargetDate() {
            const urlParams = new URLSearchParams(window.location.search);
            const dateParam = urlParams.get('date');

            // Validate date parameter format (YYYY-MM-DD)
            if (dateParam && /^\d{4}-\d{2}-\d{2}$/.test(dateParam)) {
                return dateParam;
            }

            // Default to today
            return formatDate(new Date());
        }

        // Calculate today's date
        const targetDate = getTargetDate();
        const readingUrl = `/readings/${targetDate}/`;

        // Add canonical link for SEO
        const canonical = document.createElement('link');
        canonical.rel = 'canonical';
        canonical.href = window.location.origin + readingUrl;
        document.head.appendChild(canonical);

        // Fetch today's reading content
        fetch(readingUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Reading not found');
                }
                return response.text();
            })
            .then(html => {
                // Parse the HTML
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                // Extract the navigation and reading content
                const nav = doc.querySelector('.day-nav');
                const content = doc.querySelector('.daily-reading-container');

                if (content) {
                    // Build HTML with navigation + content
                    let fullHTML = '';
                    if (nav) {
                        fullHTML += nav.outerHTML;
                    }
                    fullHTML += content.outerHTML;

                    // Replace loading message with actual content
                    document.getElementById('reading-container').innerHTML = fullHTML;

                    // Update page title
                    const title = doc.querySelector('title');
                    if (title) {
                        document.title = title.textContent;
                    }

                    // Reinitialize JavaScript for the dynamically loaded content
                    // reading.js exposes window.sjlcReadingInit for this purpose
                    if (typeof window.sjlcReadingInit === 'function') {
                        window.sjlcReadingInit();
                    }
                }
            })
            .catch(error => {
                console.error('Error loading reading:', error);
                document.getElementById('reading-container').innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <p>Sorry, today's reading could not be loaded.</p>
                        <p><a href="${readingUrl}">Click here to try again</a></p>
                    </div>
                `;
            });
    })();
</script>
